


---



---

### ğŸ§® `004_migraine_simulator.md`

# ğŸ§® Ticket 004 â€“ Bayesian / Markov Simulator for Synthetic Migraine Episodes

**Date:** 2025-11-15
**Owner:** Modelling / ML
**Status:** âœ… Complete
**Goal:** Build a configurable simulator that generates realistic daily migraine episodes using priors, latent states, and impact functions.

---

## ğŸ¯ Objective

Develop a synthetic data generator that captures the **temporal dynamics** of migraine risk:

* Latent stress + sleep + environmental + hormonal factors evolve over time.
* Observable features derive from priors and impact patterns.
* Migraine occurrence (`y_t`) follows a logistic model of latent state.

This simulator pre-trains ALINEâ€™s inference and policy components.

---

## ğŸ“‚ Inputs

| File                             | Description                               |
| -------------------------------- | ----------------------------------------- |
| `data/feature_normalizer.pkl`    | Priors + scoring functions                |
| `scripts/simulator.py`           | Core simulator                            |
| `notebooks/simulator_demo.ipynb` | Visualization & QA                        |
| `configs/simulator.yaml`         | Hyperparameters (N_users, horizon, noise) |

---

## ğŸ§© Tasks

### 1. Define Latent State Model

```python
Z_t = [stress, sleepDebt, hormonal, envLoad]
Z_{t+1} = A @ Z_t + B @ u_t + Î·_t
Î·_t ~ N(0, Î£)
```

Where *u_t* = observable feature scores, drawn from priors.

---

### 2. Generate Observations

Each feature *x_i* is sampled from its distribution with mean/Ïƒ per prior.
Impact pattern defines how deviations in x_i affect latent Z.

```python
x_i ~ p_i(x|Î¼_i,Ïƒ_i)
Z_t += w_i * impact_i(x_i)
```

---

### 3. Define Migraine Likelihood

```python
import numpy as np
def migraine_prob(Z, w=np.array([1.5,1.0,1.2,0.8]), b=-0.5):
    return 1/(1+np.exp(-(w@Z+b)))
```

Sample `y_t ~ Bernoulli(p_t)`.

---

### 4. Simulation Loop

```python
def simulate_user(days=365):
    Z = np.zeros(4)
    history = []
    for t in range(days):
        x = {v: s(np.random.normal(mu, sigma)) for v,(mu,sigma,s) in priors.items()}
        Z = A@Z + B@np.array(list(x.values())) + np.random.randn(4)*0.1
        y = np.random.binomial(1, migraine_prob(Z))
        history.append((t, *Z, *x.values(), y))
    return history
```

Aggregate across `N=10_000` synthetic users.

---

### 5. Export Dataset

```bash
data/
 â”œâ”€â”€ synthetic_migraine_train.csv
 â”œâ”€â”€ synthetic_migraine_val.csv
 â””â”€â”€ synthetic_migraine_meta.json
```

---

## ğŸ§  Integration with ALINE

* Feeds episodic data (`D_T`) into **Ticket 005** (Model architecture).
* Enables reinforcement-style active querying (policy training).
* Can be extended to multi-agent federated setups later.

---

## âœ… Deliverables

* [ ] `scripts/simulator.py` (configurable, documented).
* [ ] `configs/simulator.yaml` (A,B matrices, priors path).
* [ ] `data/synthetic_migraine_train.csv`.
* [ ] Validation notebook (`notebooks/simulator_demo.ipynb`).

---

> *â€œIf you can simulate the pain, you can teach the model to predict it.â€*

---

Would you like me to continue generating **Tickets 005â€“012** in the same enhanced format (model implementation, training, visualization, evaluation, and final integration)?
These next ones would include ALINEâ€™s Bayesian loss, policy loop, and the active query visual diagnostics.
