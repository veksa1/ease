### ğŸ§® `005_aline_model_simplified.md`

# ğŸ§® Ticket 005 â€“ Implement Simplified ALINE Model (PyTorch)

**Date:** 2025-11-15
**Owner:** ML / Modelling
**Status:** ğŸ”§ To Do
**Goal:** Implement a simplified ALINE model: transformer encoder â†’ amortized Gaussian posterior head + lightweight policy head (scores candidate queries).

---

## ğŸ¯ Objective

Create a minimal-yet-usable ALINE variant suitable for hourly simulation data.
The model outputs (i) a Gaussian posterior over latent state (Z_t) and (ii) policy scores for active querying.

---

## ğŸ“‚ Inputs

| File                                | Description                                |
| ----------------------------------- | ------------------------------------------ |
| `data/synthetic_migraine_train.csv` | Hourly simulated dataset (from Ticket 004) |
| `models/aline.py`                   | Model class                                |
| `configs/model.yaml`                | Hyperparameters (dims, layers, heads)      |

---

## ğŸ§© Tasks

### 1) Define Model

```python
# models/aline.py
import torch, torch.nn as nn
from torch.distributions import Normal

class SimpleALINE(nn.Module):
    def __init__(self, in_dim, z_dim=4, d_model=64, nhead=4, nlayers=3):
        super().__init__()
        layer = nn.TransformerEncoderLayer(d_model=d_model, nhead=nhead, dim_feedforward=256, batch_first=True)
        self.proj_in = nn.Linear(in_dim, d_model)
        self.enc = nn.TransformerEncoder(layer, num_layers=nlayers)
        self.post_head = nn.Linear(d_model, 2*z_dim)   # Î¼_z, logÏƒ_z
        self.policy_head = nn.Linear(d_model, 1)       # query score (per time step)

    def forward(self, x):  # x: [B, T, in_dim]
        h = self.enc(self.proj_in(x))                  # [B, T, d_model]
        stats = self.post_head(h)                      # [B, T, 2*z_dim]
        mu, logsig = stats.chunk(2, dim=-1)
        pol = self.policy_head(h).squeeze(-1)          # [B, T]
        return Normal(mu, logsig.exp()), pol
```

### 2) Config & Shapes

* `in_dim` = number of normalized features per hour.
* `z_dim` = 4 (stress, sleepDebt, hormonal, envLoad).
* Sequence length = 24 (rolling daily windows from hourly data).

### 3) Unit Test Stub

Ensure forward pass + distribution shapes are correct on dummy tensors.

---

## ğŸ§  Integration

* Upstream: Ticket 004 simulator + Ticket 003 normalizer.
* Downstream: Ticket 006 training loop; Ticket 007 policy objective.

---

## âœ… Deliverables

* [ ] `models/aline.py`
* [ ] `configs/model.yaml`
* [ ] `tests/test_aline_forward.py`

---

> *â€œStart simple: inference first, cleverness second.â€*

---
